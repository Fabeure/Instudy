{% extends "base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/chat.css') }}">
{% endblock  %}
{% block title %}Chat{% endblock %}
{% block jsdelivr %} {% endblock %}
{% block body %}
    {%  block header %} {{ parent() }}
        {% block errors %} {% endblock %}
    {% endblock %}
<link rel="stylesheet" href="{{ asset('assets/css/chat.css') }}">
    {% set link = 'https://example.com/books/1' %}
        <div class="container app">
            <div class="row app-one">
                <div class="conversation">
                    <div class="row heading">
                        <div class="col-sm-2 col-md-1 col-xs-3 heading-avatar">
                            <div class="heading-avatar-icon">
                                <img src="https://bootdey.com/img/Content/avatar/avatar6.png">
                            </div>
                        </div>
                        <div class="col-sm-8 col-xs-7 heading-name">
                            <a class="heading-name-meta">{{ id }}
                            </a>
                        </div>
                    </div>
                    <div class="row message" id="conversation">
                        <div class="row message-body">
                            <div class="col-sm-12 message-main-receiver">
                                <div class="receiver">
                                    <div class="message-text">
                                        Hi, what are you doing?!
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row message-body">
                            <div class="col-sm-12 message-main-sender">
                                <div class="sender">
                                    <div class="message-text">
                                        I am doing nothing man!
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row message-body">
                            <div class="col-sm-12 message-main-sender">
                                <div class="sender">
                                    <div class="message-text">
                                        I am doing nothing man!
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row message-body">
                            <div class="col-sm-12 message-main-receiver">
                                <div class="receiver">
                                    <div class="message-text">
                                        Hi, what are you doing?!
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row message-body">
                            <div class="col-sm-12 message-main-receiver">
                                <div class="receiver">
                                    <div class="message-text">
                                        Hi, what are you doing?!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row reply">
                        <div class="col-sm-9 col-xs-9 reply-main">
                            <textarea class="form-control" rows="1" id="reply"></textarea>
                        </div>
                        <button id="my-button">aa</button>
                        </div>
                    </div>
                </div>
            </div>
    <script>
        window.chat= {
            id: "{{ id }}",
            author: "{{ app.user.username }}"
        };
    </script>
    <script>
        const eventSource = new EventSource("{{ mercure(link)|escape('js') }}");
        eventSource.onmessage = event => {
            // Will be called every time an update is published by the server
            const data = JSON.parse(event.data);
            //check if i am sender or receiver
            if (data.author === "{{ app.user.username }}"){
                const new_message = create(data.message, "SENDER")
                insert(new_message)
            }
            else{
                const new_message = create(data.message, "RECEIVER")
                insert(new_message)
            }
        }
    </script>
    <script src="{{ asset('assets/js/chat.js') }}"

{% endblock %}